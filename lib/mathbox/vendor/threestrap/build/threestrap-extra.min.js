THREE.Stats=function(){var e=Date.now(),t=e,n=0,o=1/0,i=0,s=0,a=1/0,r=0,c=0,h=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(e){e.preventDefault(),g(++h%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(d);var u=document.createElement("div");u.id="fpsText",u.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",u.innerHTML="FPS",d.appendChild(u);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(p);74>p.children.length;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(m)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var E=document.createElement("div");E.id="msText",E.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",E.innerHTML="MS",v.appendChild(E);var f=document.createElement("div");for(f.id="msGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(f);74>f.children.length;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",f.appendChild(m);var g=function(e){switch(h=e){case 0:d.style.display="block",v.style.display="none";break;case 1:d.style.display="none",v.style.display="block"}};return{REVISION:11,domElement:l,setMode:g,begin:function(){e=Date.now()},end:function(){var h=Date.now();n=h-e,o=Math.min(o,n),i=Math.max(i,n),E.textContent=n+" MS ("+o+"-"+i+")";var l=Math.min(30,30-30*(n/200));return f.appendChild(f.firstChild).style.height=l+"px",c++,h>t+1e3&&(s=Math.round(1e3*c/(h-t)),a=Math.min(a,s),r=Math.max(r,s),u.textContent=s+" FPS ("+a+"-"+r+")",l=Math.min(30,30-30*(s/100)),p.appendChild(p.firstChild).style.height=l+"px",t=h,c=0),h},update:function(){e=this.end()}}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.freeze=!0,this.deviceOrientation={},this.screenOrientation=0;var n=function(e){t.deviceOrientation=e},o=function(){t.screenOrientation=window.orientation||0},i=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,s,a,r,c){t.set(a,s,-r,"YXZ"),i.setFromEuler(t),i.multiply(o),i.multiply(n.setFromAxisAngle(e,-c))}}();this.connect=function(){o(),window.addEventListener("orientationchange",o,!1),window.addEventListener("deviceorientation",n,!1),t.freeze=!1},this.disconnect=function(){t.freeze=!0,window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientation",n,!1)},this.update=function(){if(!t.freeze){var e=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.alpha):0,n=t.deviceOrientation.beta?THREE.Math.degToRad(t.deviceOrientation.beta):0,o=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.gamma):0,s=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;i(t.object.quaternion,e,n,o,s)}}},THREE.FirstPersonControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(!this.freeze){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),n=t-this.heightMin;this.autoSpeedFactor=e*n*this.heightCoef}else this.autoSpeedFactor=0;var o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);var i=e*this.lookSpeed;this.activeLook||(i=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*s),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var a=this.target,r=this.object.position;a.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),a.y=r.y+100*Math.cos(this.phi),a.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(a)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",n(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",n(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",n(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",n(this,this.onKeyUp),!1),this.handleResize()},THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*u.autoRotateSpeed}function o(){return Math.pow(.95,u.zoomSpeed)}function i(e){if(u.enabled!==!1){if(e.preventDefault(),0===e.button){if(u.noRotate===!0)return;D=L.ROTATE,m.set(e.clientX,e.clientY)}else if(1===e.button){if(u.noZoom===!0)return;D=L.DOLLY,R.set(e.clientX,e.clientY)}else if(2===e.button){if(u.noPan===!0)return;D=L.PAN,f.set(e.clientX,e.clientY)}document.documentElement.addEventListener("mousemove",s,!1),document.documentElement.addEventListener("mouseup",a,!1),u.dispatchEvent(S)}}function s(e){if(u.enabled!==!1){e.preventDefault();var t=u.domElement===document?u.domElement.body:u.domElement;if(D===L.ROTATE){if(u.noRotate===!0)return;v.set(e.clientX,e.clientY),E.subVectors(v,m),u.rotateLeft(2*Math.PI*E.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*E.y/t.clientHeight*u.rotateSpeed),m.copy(v)}else if(D===L.DOLLY){if(u.noZoom===!0)return;T.set(e.clientX,e.clientY),k.subVectors(T,R),k.y>0?u.dollyIn():u.dollyOut(),R.copy(T)}else if(D===L.PAN){if(u.noPan===!0)return;g.set(e.clientX,e.clientY),b.subVectors(g,f),u.pan(b.x,b.y),f.copy(g)}u.update()}}function a(){u.enabled!==!1&&(document.documentElement.removeEventListener("mousemove",s,!1),document.documentElement.removeEventListener("mouseup",a,!1),u.dispatchEvent(F),D=L.NONE)}function r(e){if(u.enabled!==!1&&u.noZoom!==!0){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?u.dollyOut():u.dollyIn(),u.update(),u.dispatchEvent(S),u.dispatchEvent(F)}}function c(e){if(u.enabled!==!1&&u.noKeys!==!0&&u.noPan!==!0)switch(e.keyCode){case u.keys.UP:u.pan(0,u.keyPanSpeed),u.update();break;case u.keys.BOTTOM:u.pan(0,-u.keyPanSpeed),u.update();break;case u.keys.LEFT:u.pan(u.keyPanSpeed,0),u.update();break;case u.keys.RIGHT:u.pan(-u.keyPanSpeed,0),u.update()}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:if(u.noRotate===!0)return;D=L.TOUCH_ROTATE,m.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(u.noZoom===!0)return;D=L.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);R.set(0,o);break;case 3:if(u.noPan===!0)return;D=L.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:D=L.NONE}u.dispatchEvent(S)}}function l(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=u.domElement===document?u.domElement.body:u.domElement;switch(e.touches.length){case 1:if(u.noRotate===!0)return;if(D!==L.TOUCH_ROTATE)return;v.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(v,m),u.rotateLeft(2*Math.PI*E.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*E.y/t.clientHeight*u.rotateSpeed),m.copy(v),u.update();break;case 2:if(u.noZoom===!0)return;if(D!==L.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(n*n+o*o);T.set(0,i),k.subVectors(T,R),k.y>0?u.dollyOut():u.dollyIn(),R.copy(T),u.update();break;case 3:if(u.noPan===!0)return;if(D!==L.TOUCH_PAN)return;g.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(g,f),u.pan(b.x,b.y),f.copy(g),u.update();break;default:D=L.NONE}}}function d(){u.enabled!==!1&&(u.dispatchEvent(F),D=L.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var u=this,p=1e-6,m=new THREE.Vector2,v=new THREE.Vector2,E=new THREE.Vector2,f=new THREE.Vector2,g=new THREE.Vector2,b=new THREE.Vector2,y=new THREE.Vector3,w=new THREE.Vector3,R=new THREE.Vector2,T=new THREE.Vector2,k=new THREE.Vector2,H=0,x=0,M=1,O=new THREE.Vector3,V=new THREE.Vector3,L={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},D=L.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var C=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),P=C.clone().inverse(),j={type:"change"},S={type:"start"},F={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=n()),x-=e},this.rotateUp=function(e){void 0===e&&(e=n()),H-=e},this.panLeft=function(e){var t=this.object.matrix.elements;y.set(t[0],t[1],t[2]),y.multiplyScalar(-e),O.add(y)},this.panUp=function(e){var t=this.object.matrix.elements;y.set(t[4],t[5],t[6]),y.multiplyScalar(e),O.add(y)},this.pan=function(e,t){var n=u.domElement===document?u.domElement.body:u.domElement;if(void 0!==u.object.fov){var o=u.object.position,i=o.clone().sub(u.target),s=i.length();s*=Math.tan(u.object.fov/2*Math.PI/180),u.panLeft(2*e*s/n.clientHeight),u.panUp(2*t*s/n.clientHeight)}else void 0!==u.object.top?(u.panLeft(e*(u.object.right-u.object.left)/n.clientWidth),u.panUp(t*(u.object.top-u.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=o()),M/=e},this.dollyOut=function(e){void 0===e&&(e=o()),M*=e},this.update=function(){var e=this.object.position;w.copy(e).sub(this.target),w.applyQuaternion(C);var t=Math.atan2(w.x,w.z),o=Math.atan2(Math.sqrt(w.x*w.x+w.z*w.z),w.y);this.autoRotate&&this.rotateLeft(n()),t+=x,o+=H,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(p,Math.min(Math.PI-p,o));var i=w.length()*M;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(O),w.x=i*Math.sin(o)*Math.sin(t),w.y=i*Math.cos(o),w.z=i*Math.sin(o)*Math.cos(t),w.applyQuaternion(P),e.copy(this.target).add(w),this.object.lookAt(this.target),x=0,H=0,M=1,O.set(0,0,0),V.distanceToSquared(this.object.position)>p&&(this.dispatchEvent(j),V.copy(this.object.position))},this.reset=function(){D=L.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",r,!1),this.domElement.addEventListener("DOMMouseScroll",r,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",c,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls=function(e,t){function n(e){d.enabled!==!1&&(window.removeEventListener("keydown",n),E=v,v===u.NONE&&(e.keyCode!==d.keys[u.ROTATE]||d.noRotate?e.keyCode!==d.keys[u.ZOOM]||d.noZoom?e.keyCode!==d.keys[u.PAN]||d.noPan||(v=u.PAN):v=u.ZOOM:v=u.ROTATE))}function o(){d.enabled!==!1&&(v=E,window.addEventListener("keydown",n,!1))}function i(e){d.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v===u.NONE&&(v=e.button),v!==u.ROTATE||d.noRotate?v!==u.ZOOM||d.noZoom?v!==u.PAN||d.noPan||(x.copy(D(e.pageX,e.pageY)),M.copy(x)):(R.copy(D(e.pageX,e.pageY)),T.copy(R)):(b.copy(C(e.pageX,e.pageY)),g.copy(b)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),d.dispatchEvent(V))}function s(e){d.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v!==u.ROTATE||d.noRotate?v!==u.ZOOM||d.noZoom?v!==u.PAN||d.noPan||M.copy(D(e.pageX,e.pageY)):T.copy(D(e.pageX,e.pageY)):(g.copy(b),b.copy(C(e.pageX,e.pageY))))}function a(e){d.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v=u.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),d.dispatchEvent(L))}function r(e){if(d.enabled!==!1&&!d.noZoom){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),R.y+=.01*t,d.dispatchEvent(V),d.dispatchEvent(L)}}function c(e){if(d.enabled!==!1){switch(e.touches.length){case 1:v=u.TOUCH_ROTATE,b.copy(C(e.touches[0].pageX,e.touches[0].pageY)),g.copy(b);break;case 2:v=u.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;H=k=Math.sqrt(t*t+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;x.copy(D(o,i)),M.copy(x);break;default:v=u.NONE}d.dispatchEvent(V)}}function h(e){if(d.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:g.copy(b),b.copy(C(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;H=Math.sqrt(t*t+n*n);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(D(o,i));break;default:v=u.NONE}}function l(e){if(d.enabled!==!1){switch(e.touches.length){case 1:g.copy(b),b.copy(C(e.touches[0].pageX,e.touches[0].pageY));break;case 2:k=H=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(D(t,n)),x.copy(M)}v=u.NONE,d.dispatchEvent(L)}}var d=this,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=1e-6,m=new THREE.Vector3,v=u.NONE,E=u.NONE,f=new THREE.Vector3,g=new THREE.Vector2,b=new THREE.Vector2,y=new THREE.Vector3,w=0,R=new THREE.Vector2,T=new THREE.Vector2,k=0,H=0,x=new THREE.Vector2,M=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var O={type:"change"},V={type:"start"},L={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var D=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-d.screen.left)/d.screen.width,(n-d.screen.top)/d.screen.height),e}}(),C=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(d.screen.height+2*(d.screen.top-n))/d.screen.width),e}}();this.rotateCamera=function(){var e,t=new THREE.Vector3,n=new THREE.Quaternion,o=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3;return function(){a.set(b.x-g.x,b.y-g.y,0),e=a.length(),e?(f.copy(d.object.position).sub(d.target),o.copy(f).normalize(),i.copy(d.object.up).normalize(),s.crossVectors(i,o).normalize(),i.setLength(b.y-g.y),s.setLength(b.x-g.x),a.copy(i.add(s)),t.crossVectors(a,f).normalize(),e*=d.rotateSpeed,n.setFromAxisAngle(t,e),f.applyQuaternion(n),d.object.up.applyQuaternion(n),y.copy(t),w=e):!d.staticMoving&&w&&(w*=Math.sqrt(1-d.dynamicDampingFactor),f.copy(d.object.position).sub(d.target),n.setFromAxisAngle(y,w),f.applyQuaternion(n),d.object.up.applyQuaternion(n)),g.copy(b)}}(),this.zoomCamera=function(){var e;v===u.TOUCH_ZOOM_PAN?(e=k/H,k=H,f.multiplyScalar(e)):(e=1+(T.y-R.y)*d.zoomSpeed,1!==e&&e>0&&(f.multiplyScalar(e),d.staticMoving?R.copy(T):R.y+=(T.y-R.y)*this.dynamicDampingFactor))},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.copy(M).sub(x),e.lengthSq()&&(e.multiplyScalar(f.length()*d.panSpeed),n.copy(f).cross(d.object.up).setLength(e.x),n.add(t.copy(d.object.up).setLength(e.y)),d.object.position.add(n),d.target.add(n),d.staticMoving?x.copy(M):x.add(e.subVectors(M,x).multiplyScalar(d.dynamicDampingFactor)))}}(),this.checkDistances=function(){d.noZoom&&d.noPan||(f.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.addVectors(d.target,f.setLength(d.maxDistance)),f.lengthSq()<d.minDistance*d.minDistance&&d.object.position.addVectors(d.target,f.setLength(d.minDistance)))},this.update=function(){f.subVectors(d.object.position,d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.addVectors(d.target,f),d.checkDistances(),d.object.lookAt(d.target),m.distanceToSquared(d.object.position)>p&&(d.dispatchEvent(O),m.copy(d.object.position))},this.reset=function(){v=u.NONE,E=u.NONE,d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.up.copy(d.up0),f.subVectors(d.object.position,d.target),d.object.lookAt(d.target),d.dispatchEvent(O),m.copy(d.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",r,!1),this.domElement.addEventListener("DOMMouseScroll",r,!1),this.domElement.addEventListener("touchstart",c,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",h,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.VRControls=function(e,t){var n=1e-5,o=this.dummy=new THREE.Object3D;this.object=e,this.device=new THREE.DeviceOrientationControls(o,t),this.orbit=new THREE.OrbitControls(o,t),this.orbit.target.copy(e.position),this.orbit.target.z+=n,this.orbit.rotateSpeed=-.25,this.supported=!1;var i=function(e){this.supported=e&&e.alpha==+e.alpha,window.removeEventListener("deviceorientation",i,!1)}.bind(this);window.addEventListener("deviceorientation",i,!1)},THREE.VRControls.prototype.vr=function(e){this.vrstate=e},THREE.VRControls.prototype.update=function(e){var t=!1;this.vrstate&&this.vrstate.orientation?(t=!0,this.object.quaternion.copy(this.vrstate.orientation),this.object.position.copy(this.vrstate.position),this.device.object=this.dummy,this.orbit.object=this.dummy):this.vrstate&&this.supported?(this.device.freeze&&this.device.connect(),this.device.object=this.object,this.orbit.object=this.dummy,this.device.update(e)):(t=!0,this.device.object=this.dummy,this.orbit.object=this.object,this.orbit.update(e)),t&&!this.device.freeze&&this.device.disconnect()},THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new THREE.Stats,n=t.domElement.style;n.position="absolute",n.top=n.left=0,e.element.appendChild(t.domElement),e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement),delete e.stats},pre:function(){this.stats.begin()},post:function(){this.stats.end()}}),THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null,this._camera=e.camera||new THREE.PerspectiveCamera,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.options.klass?((!e||e.changes.klass)&&(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),_.extend(t.controls,this.options.parameters)):t.controls=null},update:function(e,t){var n=t.Time&&t.Time.delta||1/60,o=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(o),t.controls.update(n)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}}),THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(e){this.timeout=this.options.timeout,this.element=e.element,this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(e,t){var n=t.Time&&t.Time.delta||1/60;this.options.hide&&(this.timeout-=n,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(e,t){this.hide=e.active&&!e.hmd.fake,this.applyCursor(t)},applyCursor:function(e,t){var n=e.controls?"move":"";t=t||this.options.cursor||n,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}}),THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){this.options.key&&e.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}.bind(this));var n=function(){var e=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);t.Fullscreen.active=this.active=e,t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1)},toggle:function(e){var t=e.canvas,n=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(n):t.msRequestFullScreen?t.msRequestFullscreen(n):t.webkitRequestFullscreen?t.webkitRequestFullscreen(n):t.mozRequestFullScreen&&t.mozRequestFullScreen(n)}}),THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(e){e.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(e,t,n){var o=.03,i=function(e){return{left:{x:-o,y:0,z:0},right:{x:o,y:0,z:0}}[e]},s=function(o){var i=e.camera,s=i&&i.aspect||16/9,a=(t||i&&i.fov||n)/2,r=180*Math.atan(Math.tan(a*Math.PI/180)*s/2)/Math.PI,c=a;return{left:{rightDegrees:r,leftDegrees:r,downDegrees:c,upDegrees:c},right:{rightDegrees:r,leftDegrees:r,downDegrees:c,upDegrees:c}}[o]},a=function(){return{}};return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:i,getRecommendedEyeFieldOfView:s},{force:2,getState:a}]},load:function(e,t){var n=function(e){this.callback(e,t)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(n):navigator.mozGetVRDevices?navigator.mozGetVRDevices(n):(console.warn("No native VR support detected."),n(this.mocks(t,this.options.fov,this.defaults.fov),t))},callback:function(e,t){var n,o,i=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;for(var a=this.options.device,r=0;r<e.length;++r){var c=e[r];if(1==c.force||c instanceof i){if(a&&a!=c.deviceId)continue;n=c;break}}if(n){for(var r=0;r<e.length;++r){var c=e[r];if(2==c.force||c instanceof s&&c.hardwareUnitId==n.hardwareUnitId){o=c;break}}this.hookup(n,o,t)}},hookup:function(e,t,n){THREE.VRRenderer||console.log("THREE.VRRenderer not found");var o=THREE.VRRenderer||function(){};this.renderer=new o(n.renderer,e),this.hmd=e,this.sensor=t,n.VR.renderer=this.renderer,n.VR.hmd=e,n.VR.sensor=t,console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){e.changes.device&&this.callback(null,t),this.pre(e,t)},pre:function(e,t){var n=this.active,o=this.active=this.renderer&&"2d"!=this.options.mode;if(t.VR.active=o,o&&this.sensor){var i=this.sensor.getState();t.VR.state=i}else t.VR.state=null;n!=this.active&&t.trigger({type:"vr",active:o,hmd:this.hmd,sensor:this.sensor})},resize:function(){this.active&&this.renderer.initialize()},render:function(e,t){if(t.scene&&t.camera){var n=this.active?this.renderer:t.renderer;if(this.last!=n&&n==t.renderer){var o=n.getPixelRatio(),i=n.domElement.width/o,s=n.domElement.height/o;n.enableScissorTest(!1),n.setViewport(0,0,i,s)}this.last=n,n.render(t.scene,t.camera)}}}),THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,n){var o="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(o="http://"+o);var i=[];return e.Fullscreen&&i.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),e.VR&&i.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+o+'"); '+n+'</style><div class="threestrap-ui threestrap-'+t+'">'+i.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style),document.body.appendChild(t);var n=this.ui.fullscreen=t.querySelector("button.fullscreen");n&&e.bind([n,"click:goFullscreen"],this);var o=this.ui.vr=t.querySelector("button.vr");o&&e.VR&&(e.VR.set({mode:"2d"}),e.bind([o,"click:goVR"],this))},uninstall:function(){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block",e.active||t.VR&&t.VR.set({mode:"2d"})},goFullscreen:function(e,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(e,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(){document.body.removeChild(this.ui)}});